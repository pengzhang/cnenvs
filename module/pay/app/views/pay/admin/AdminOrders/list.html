#{extends 'CRUD/layout.html' /}
#{set title:messages.get('crud.list.title', type.name) /}
<div class="col-sm-9 col-sm-offset-3 col-lg-10 col-lg-offset-2">	
	<div class="row">
		<div class="col-lg-12">
			<div id="crudList" class="${type.name}">
			
			    <h2 id="crudListTitle">&{'crud.list.title', type.name}</h2>
			
			    <div id="crudListSearch">
			        #{crud.search /}
			    </div>
			
			    <div id="crudListTable">
			        #{crud.table fields:['id','out_trade_no','trade_no','trade_type','status','total_fee','pay_date','buyer_name','buyer_mobile','buyer_address','operation']}
			         	#{crud.custom 'out_trade_no'}
			         		${object.out_trade_no}
			         	#{/crud.custom}
			         	#{crud.custom 'status'}
			         		#{if object.status}
			         			<span class="text-success">已支付</span>
			         		#{/if}
			         		#{else}
			         			<span class="text-danger">未支付</span>
			         		#{/else}
			         	#{/crud.custom}
			         	#{crud.custom 'trade_type'}
			         		#{if object.trade_type==1}
			         			<span class="text-info">微信二维码</span>
			         		#{/if}
			         		#{if object.trade_type==2}
			         			<span class="text-info">微信公众号</span>
			         		#{/if}
			         		#{if object.trade_type==3}
			         			<span class="text-info">支付宝</span>
			         		#{/if}
			         		#{if object.trade_type==4}
			         			<span class="text-info">手机支付宝</span>
			         		#{/if}
			         	#{/crud.custom}
			         	#{crud.custom 'total_fee'}
				        	￥<strong>${(object.total_fee/100).toString().rmb()}</strong>
				        #{/crud.custom}
			         	#{crud.custom 'pay_date'}
				        	${object.pay_date?object.pay_date.date():''}
				        #{/crud.custom}
				        #{crud.custom 'operation'}
				        	<a href="javascript:;" data="${object.out_trade_no}" class="btn btn-primary detail">详情</a>
				        #{/crud.custom}
			        #{/crud.table}
			    </div>
			
			    <div id="crudListPagination">
			        #{crud.pagination /}
			    </div>
			    
			</div>
		</div>
	</div>
</div>
<div id="modal" class="modal fade">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal"
					aria-label="Close">
					<span aria-hidden="true">&times;</span>
				</button>
				<h4 class="modal-title">订单详情</h4>
			</div>
			<div class="modal-body">
				
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
			</div>
		</div>
		<!-- /.modal-content -->
	</div>
	<!-- /.modal-dialog -->
</div>
<!-- /.modal -->
#{set 'moreStyles'}
<style>
.modal-body {
	background-color: #f1f4f7;
}

.order_detail .table > tbody > tr > td {
  border-top: 0px solid #ddd;
}
</style>
#{/set}
#{set 'moreScripts'}
<script>
	$(function(){
		$('tr th').addClass('col-lg-2');
		$('.panel .panel-heading a').remove();
		$('.detail').click(function(){
			var $modal = $('#modal').modal('show');
			$.ajax({
				url:'/admin/adminorders/order/detail?id='+$(this).attr('data'),
				type:'GET',
				success:function(data){
					$('.modal-body').html(data);
				},
				error:function(e){
					console.log(e)
				}
			})
			
		})
	})
</script>
#{/set}


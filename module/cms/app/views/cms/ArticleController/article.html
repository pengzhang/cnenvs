#{extends '/cms/layout/cms.html' /}
<div class="container">
	<div class="row">
		<div class="col-lg-9">
			<article class="article">
				<!-- 文章头部 -->
				<header>
					<h1 class="text-center">${article.title}</h1>
					<dl class="dl-inline">
						<dt>发布者:</dt> <dd><a href="#">${article.author}</a></dd>
						<dt>最后修订：</dt>
						<dd>${article.createDate.format('yyyy-MM-dd HH:mm:ss')}</dd>
						<dt></dt>
						<dd class="pull-right">
						#{list article.tags, as:'tag'}
							#{if tag}
							<a href="/articles/by/tag?tagId=${tag.id}"><span class="label label-success">${tag.tag}</span> </a>
							#{/if}
						#{/list}
						
						<span class="label label-warning"><i class="icon icon-comment"></i> ${article.comments.size()}</span> 
						<span class="label label-info"><i class="icon icon-thumbs-up"></i> ${article.likes.size()}</span> 
						<span class="label label-danger"><i class="icon-eye-open"></i> ${article.view_total}</span>
						</dd>
					</dl>
					<section class="abstract">
						<p>${article.content.cutString(300).htmlText()}</p>
					</section>
				</header>
				<!-- 文章正文部分 -->
				<section class="content">
						${article.content.raw()}
				</section>
				
				
				<!-- 文章底部 -->
				<footer>
					<!-- 
					<ul class="pager pager-justify">
						<li class="previous">
							<a href="#"><i class="icon-arrow-left"></i> 上一篇</a>
						</li>
						<li class="next">
							<a href="#">没有下一篇 <i class="icon-arrow-right"></i></a>
						</li>
					</ul>
					 -->
					<div class="art-foot">
						<div class="zs">
							<button type="button" class="zsbtn bg-primary like_btn" title="赞"><i class="icon-thumbs-o-up"></i></button>
							<button type="button" class="zsbtn bg-danger" title="打赏">赏</button>
							<button type="button" class="zsbtn bg-special" title="分享"><i class="icon-link"></i></button>
						</div>
					</div>
				</footer>
			</article>
		</div>
		<div class="col-lg-3 right_bar">
			#{include '/cms/ArticleController/sectionRecommendArticle.html' /}
		</div>
	</div>
</div>
#{include '/cms/ArticleController/articleComment.html' /}

#{set 'css'}
<link rel="stylesheet" type="text/css" href="/public/cnenvs/css/common.css" />
<link rel="stylesheet" type="text/css" href="/public/cms/stylesheets/article.css" />
#{/set}
#{set 'js'}
<script>
	$(function(){
		$('.like_btn').on('click', function() {
			$.ajax({
				url:'/article/like?id=${article.id}',
				type:'get',
				success:function(data){
					if(data.status){
						new $.zui.Messager(data.message, {
					        icon: 'icon-thumbs-o-up',
					        placement:'bottom',
					        type:'success'
					    }).show();
					}else{
						new $.zui.Messager(data.message, {
					        icon: 'icon-thumbs-o-up',
					        placement:'bottom',
					        type:'danger'
					    }).show();
					}
				},
				error:function(e){
					console.log(e);
				}
			})
		});

		$("#send_comment").click(function(){
			var content = $("#content").val();
			$.ajax({
				url:'/article/add/comment?id=${article.id}',
				type:'post',
				data:{'comment.comment':content},
				success:function(data){
					$(".comments-list").prepend(data);
					$("#content").val('');
					new $.zui.Messager('评论成功', {
				        icon: 'icon-comment',
				        placement:'bottom',
				        type:'success'
				    }).show();
				},
				error:function(e){
					console.log(e);
				}
			})
		})
		var commentPage = 2;
		$(".readmore").click(function(){
			$.ajax({
				url:'/article/get/comments?id=${article.id}&size=10&page='+commentPage,
				type:'get',
				success:function(data){
					if(data){
						$(".comments-list").append(data);
						commentPage++;
					}else{
						$(".readmore").remove();
					}
				},
				error:function(e){
					console.log(e);
				}
			})
		})
	})
</script>
#{/set}